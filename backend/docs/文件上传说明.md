# 文件上传功能说明

## 功能概述

系统支持图片上传功能，用于文章封面、内容图片等场景。上传的文件按日期自动分类存储。

## 接口信息

### 上传图片

**接口地址：** `POST /api/upload/image`

**请求方式：** `multipart/form-data`

**请求参数：**
- `file`: 图片文件（必填）

**限制条件：**
- 文件类型：仅支持图片格式（image/*）
- 文件大小：最大 5MB
- 请求大小：最大 10MB

**响应示例：**
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "url": "/uploads/2024/12/20/550e8400-e29b-41d4-a716-446655440000.jpg",
    "filename": "550e8400-e29b-41d4-a716-446655440000.jpg",
    "path": "2024/12/20/550e8400-e29b-41d4-a716-446655440000.jpg"
  }
}
```

## 文件存储结构

### 目录组织

文件按日期自动分类存储，目录结构如下：

```
uploads/
├── 2024/
│   ├── 12/
│   │   ├── 19/
│   │   │   ├── uuid1.jpg
│   │   │   └── uuid2.png
│   │   └── 20/
│   │       ├── uuid3.jpg
│   │       └── uuid4.png
│   └── 11/
│       └── 15/
│           └── uuid5.jpg
```

### 优势

1. **便于管理**：按日期分类，方便查找和清理
2. **性能优化**：避免单个目录文件过多
3. **备份方便**：可以按日期进行增量备份
4. **统计分析**：便于统计每日上传量

## 配置说明

### application.yml 配置

```yaml
# 文件上传配置
upload:
  path: uploads              # 上传文件保存路径
  url-prefix: /uploads       # 访问URL前缀

# Spring 文件上传配置
spring:
  servlet:
    multipart:
      enabled: true          # 启用文件上传
      max-file-size: 10MB    # 单个文件最大大小
      max-request-size: 10MB # 请求最大大小
```

### 文件命名

- 使用 UUID 生成唯一文件名
- 保留原文件扩展名
- 格式：`{uuid}.{extension}`
- 示例：`550e8400-e29b-41d4-a716-446655440000.jpg`

### 访问方式

上传成功后，可以通过以下方式访问图片：

```
http://localhost:8080/api/uploads/2024/12/20/文件名.jpg
```

例如：
```
http://localhost:8080/api/uploads/2024/12/20/550e8400-e29b-41d4-a716-446655440000.jpg
```

## 前端使用

### API 调用

```typescript
import { uploadImage } from '@/api/article'

// 上传图片
const file = event.target.files[0]
const result = await uploadImage(file)
console.log(result.url) // /uploads/2024/12/20/xxx.jpg
console.log(result.path) // 2024/12/20/xxx.jpg
```

### 完整 URL

前端需要拼接完整的图片 URL：

```typescript
const fullUrl = `${import.meta.env.VITE_API_BASE_URL}${result.url}`
// 例如：http://localhost:8080/api/uploads/2024/12/20/xxx.jpg
```

## 维护建议

### 定期清理

建议定期清理未使用的上传文件：

```bash
# 查找 30 天前的文件
find uploads -type f -mtime +30

# 删除 30 天前的文件（谨慎操作）
find uploads -type f -mtime +30 -delete
```

### 备份策略

1. **每日备份**：备份当天的上传目录
2. **增量备份**：只备份新增的日期目录
3. **定期全量备份**：每周或每月进行全量备份

### 磁盘空间监控

```bash
# 查看 uploads 目录大小
du -sh uploads

# 查看各年份目录大小
du -sh uploads/*

# 查看各月份目录大小
du -sh uploads/2024/*
```

## 注意事项

1. **目录权限**：确保应用有权限在 `uploads` 目录创建和写入文件
2. **生产环境**：建议使用 OSS（对象存储服务）替代本地存储
3. **安全性**：已添加文件类型和大小验证，防止恶意上传
4. **路径分隔符**：代码已处理 Windows 和 Linux 路径分隔符差异

## 扩展建议

### 使用 OSS

在生产环境中，建议使用云存储服务（如阿里云 OSS、腾讯云 COS）：

1. 更好的性能和可靠性
2. CDN 加速
3. 自动备份
4. 节省服务器存储空间
5. 按需付费

### 图片处理

可以集成图片处理功能：

1. 自动压缩
2. 生成缩略图
3. 水印添加
4. 格式转换
5. 智能裁剪

